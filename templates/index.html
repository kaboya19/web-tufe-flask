{% extends "base.html" %}

{% block title %}Anasayfa - Web TÃœFE{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
    <aside class="w-full md:w-80 bg-white border-r border-gray-200 shadow-lg flex flex-col justify-between py-8 px-6 flex-shrink-0" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
            <div>
                <h2 class="text-xl font-bold mb-4 gradient-text">BÃ¼lten AboneliÄŸi</h2>
                <form method="POST" action="/abone" class="space-y-4">
                    <div>
                    <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">E-posta adresiniz</label>
                    <input type="email" id="email" name="email" required class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 text-base transition-all duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ne yapmak istersiniz?</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="action" value="Abone ol" checked class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 font-medium">Abone ol</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="action" value="Ã‡Ä±k" class="form-radio text-indigo-600 h-5 w-5">
                                <span class="ml-2 font-medium">Ã‡Ä±k</span>
                            </label>
                        </div>
                    </div>
                <button type="submit" class="w-full btn-gradient text-white font-bold py-3 rounded-xl shadow-lg">GÃ¶nder</button>
                </form>
                
                <!-- Push Notification Section (Separate from Email Form) -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-bold mb-3 gradient-text">ğŸ”” TarayÄ±cÄ± Bildirimleri</h3>
                <p class="text-xs text-gray-600 mb-3">"Ä°zin Ver" diyerek anÄ±nda bildirim alÄ±n.</p>
                    <div class="mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-xs text-yellow-800 text-center">âš ï¸ Bildirimleri kapatÄ±p tekrar aÃ§manÄ±z Ã¶nerilir</p>
                    </div>
                <button id="push-notification-btn" class="w-full flex items-center justify-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 font-semibold">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        Bildirimleri AÃ§
                    </button>
                <p class="text-xs text-gray-500 mt-2 text-center"></p>
                </div>
                
                <!-- Excel Dataset Button -->
                <div class="mt-6 space-y-2">
                        <div class="flex items-center justify-center">
                    <a href="https://docs.google.com/spreadsheets/d/14iiu_MQwtMxHTFt6ceyFhkk6v0OL-wuoQS1IGPzSpNE/edit?gid=523299671#gid=523299671" target="_blank" rel="noopener" class="flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg shadow transition w-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 mr-3" viewBox="0 0 48 48">
                                    <rect width="48" height="48" rx="8" fill="#217346" />
                            <path fill="#fff" d="M14 12h20a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H14a2 2 0 0 1-2-2V14a2 2 0 0 1 2-2zm2.5 7.5 2.5 4 2.5-4h2l-3.5 5.5L23.5 32h-2l-2.5-4-2.5 4h-2l3.5-5.5L14.5 19.5h2z" />
                                </svg>
                                <span class="font-semibold text-lg">Web TÃœFE Veriseti</span>
                            </a>
                        </div>
                        <div class="flex items-center justify-center">
                    <a href="https://docs.google.com/spreadsheets/d/14iiu_MQwtMxHTFt6ceyFhkk6v0OL-wuoQS1IGPzSpNE/export?format=xlsx" target="_blank" rel="noopener" class="flex items-center px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow transition w-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <span class="font-semibold text-lg">Veriyi Ä°ndir (Excel)</span>
                            </a>
                        </div>
                    </div>

                    <!-- BÃ¼lten Button -->
                    <div class="flex items-center justify-center mt-3">
                <a href="/bultenler" class="flex items-center px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg shadow transition w-full justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 mr-3" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                        <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#E53E3E" /><text x="7" y="17" font-size="7" fill="#E53E3E" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            <span class="font-semibold text-lg">BÃ¼lten</span>
                        </a>
                    </div>

                    <!-- Buy Me a Coffee Donation Button -->
                    <div class="flex items-center justify-center mt-4">
                        <a href="https://buymeacoffee.com/webtufe" target="_blank" rel="noopener noreferrer" class="donation-button flex items-center justify-center px-6 py-4 bg-gradient-to-r from-amber-500 via-orange-500 to-amber-600 hover:from-amber-600 hover:via-orange-600 hover:to-amber-700 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 w-full transform hover:scale-105 group">
                            <svg class="w-10 h-10 mr-3 group-hover:rotate-12 transition-transform duration-300 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Coffee cup -->
                                <path d="M6 4h10a2 2 0 0 1 2 2v2h1a3 3 0 0 1 3 3v4a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-4a3 3 0 0 1 3-3h1V6a2 2 0 0 1 2-2z" fill="currentColor" opacity="0.9"/>
                                <path d="M6 4h10a2 2 0 0 1 2 2v2h1a3 3 0 0 1 3 3v4a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-4a3 3 0 0 1 3-3h1V6a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.3"/>
                                <!-- Coffee liquid -->
                                <path d="M6 8h10v1H6z" fill="white" opacity="0.8"/>
                                <!-- Steam lines -->
                                <path d="M9 2L9 4M11 2L11 4M13 2L13 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" opacity="0.6"/>
                            </svg>
                            <div class="flex flex-col items-start">
                                <span class="font-bold text-lg leading-tight">â˜• Bana Bir Kahve Ismarla</span>
                                <span class="text-xs opacity-90 font-medium">Web TÃœFE'yi destekle</span>
                            </div>
                        </a>
                    </div>

            <!-- Announcements -->
            <div class="mt-4">
                <div class="announcement-scroll space-y-4">
                    <!-- Web TÃœFE KasÄ±m 2025 BÃ¼lteni -->
                    <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg shadow-sm">
                        <div class="flex items-center mb-2">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 mr-2">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-4h2v2h-2v-2zm0-8h2v6h-2V6z" clip-rule="evenodd"></path>
                                </svg>
                                Yeni!
                            </span>
                        </div>
                        <p class="text-sm text-gray-700 mb-3 font-medium">Web TÃœFE KasÄ±m 2025 BÃ¼lteni</p>
                        <a href="/bultenler/pdf/KasÄ±m 2025.pdf" class="inline-flex items-center px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                                <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#EA580C" />
                                <text x="7" y="17" font-size="7" fill="#EA580C" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            BÃ¼lteni Oku
                        </a>
                    </div>

                    <!-- Yeni KasÄ±m Enflasyon GÃ¶rÃ¼nÃ¼mÃ¼ Duyurusu -->

                    



                    <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm">
                        <div class="flex items-center mb-2">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 mr-2">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                YayÄ±nlandÄ±!
                            </span>
                        </div>
                <p class="text-sm text-gray-700 mb-3 font-medium">Web TÃœFE KasÄ±m 2025 Enflasyon GÃ¶rÃ¼nÃ¼mÃ¼ Raporu</p>
                <a href="/bultenler/pdf/Web TÃœFE KasÄ±m Ã–ncÃ¼.pdf" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                                <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#2563EB" />
                                <text x="7" y="17" font-size="7" fill="#fff" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            Raporu Oku
                        </a>
                    </div>
                    <!-- Yeni Kapsam DeÄŸiÅŸiklikleri Duyurusu -->
                    <div class="p-4 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg shadow-sm">
                <p class="text-sm text-gray-700 mb-3 font-medium">Web TÃœFE 2026 Kapsam DeÄŸiÅŸiklikleri</p>
                <a href="/bultenler/pdf/Duyuru 20251025.pdf" class="inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                                <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#7C3AED" />
                                <text x="7" y="17" font-size="7" fill="#fff" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            Duyuruyu Oku
                        </a>
                    </div>
                    <!-- Yeni BÃ¼lten Duyurusu -->
                    <div class="p-4 bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-200 rounded-lg shadow-sm">
                <p class="text-sm text-gray-700 mb-3 font-medium">Web TÃœFE Ekim 2025 BÃ¼lteni</p>
                <a href="/bultenler/pdf/Ekim 2025.pdf" class="inline-flex items-center px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                                <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#DB2777" />
                                <text x="7" y="17" font-size="7" fill="#fff" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            BÃ¼lteni Oku
                        </a>
                    </div>
                    <!-- Rapor Duyurusu -->
                    <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm">
                <p class="text-sm text-gray-700 mb-3 font-medium">Web TÃœFE Ekim Enflasyon GÃ¶rÃ¼nÃ¼mÃ¼ Raporu (11.10.2025)</p>
                <a href="/bultenler/pdf/Web TÃœFE Ekim Ã–ncÃ¼.pdf" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none">
                                <rect width="24" height="24" rx="4" fill="#fff" />
                                <path d="M7 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8.828a2 2 0 0 0-.586-1.414l-3.828-3.828A2 2 0 0 0 13.172 2H7zm5 1.414L18.586 10H14a2 2 0 0 1-2-2V3.414zM7 4h5v4a4 4 0 0 0 4 4h4v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="#2563EB" />
                                <text x="7" y="17" font-size="7" fill="#fff" font-family="Arial, Helvetica, sans-serif">PDF</text>
                            </svg>
                            Raporu Oku
                        </a>
                    </div>
                </div>
            </div>
            </div>
        </aside>

                <!-- Main Content -->
    <main class="flex-1 w-full px-6 lg:px-8 py-8 overflow-x-hidden">
                    {% if last_update %}
                    <div class="card-modern p-6 mb-6 border-l-4 border-indigo-500">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="ml-3">
                    <p class="text-base font-semibold text-indigo-900">Son GÃ¼ncellenme Tarihi: {{ last_update }}</p>
                    <p class="mt-1 text-sm text-indigo-700">Nihai veriler her ayÄ±n 24.gÃ¼nÃ¼ belli olmaktadÄ±r.</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- YÄ±llÄ±k ve AylÄ±k DeÄŸiÅŸim Widget Banner -->
                    {% if widget_data or monthly_widget_data %}
                    <div id="yearly-widget-banner" class="yearly-widget-banner">
                        <div class="yearly-widget-banner-container">
                            <div class="widgets-grid">
                                <!-- YÄ±llÄ±k Widget -->
                                {% if widget_data %}
                                <div class="yearly-widget-card">
                                <div class="yearly-widget-header">
                                    <div class="yearly-widget-title-container">
                                        <div class="yearly-widget-icon">
                                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                            </svg>
                                        </div>
                                        <div>
                                            <h2 class="yearly-widget-title">Web TÃœFE YÄ±llÄ±k Enflasyon{% if widget_data.current_month_year_label %} - {{ widget_data.current_month_year_label }}{% endif %}</h2>
                                            <p class="yearly-widget-subtitle">WebTÃœFE-YÄ±llÄ±k</p>
                                        </div>
                                    </div>
                                    {% if widget_data.update_date %}
                                    <p class="yearly-widget-update">GÃ¼ncellendi {{ widget_data.update_date }}</p>
                                    {% endif %}
                                </div>
                                
                                <div class="yearly-widget-content">
                                    <div class="yearly-widget-status">
                                        <span class="yearly-widget-status-dot"></span>
                                        {% if widget_data.show_finalized_message and widget_data.current_value is not none and widget_data.current_month_name %}
                                        <span class="yearly-widget-status-text">{{ widget_data.current_month_name }} ayÄ±nda yÄ±llÄ±k %{{ "%.2f"|format(widget_data.current_value)|replace(".", ",") }} {% if widget_data.current_value >= 0 %}arttÄ±{% else %}azaldÄ±{% endif %}</span>
                                        {% else %}
                                        <span class="yearly-widget-status-text">YÄ±llÄ±k deÄŸiÅŸim gÃ¼nlÃ¼k gÃ¼ncelleniyor</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="yearly-widget-main-value">
                                        {% if widget_data.current_value is not none %}
                                        {{ "%.2f"|format(widget_data.current_value)|replace(".", ",") }}%
                                        {% else %}
                                        N/A
                                        {% endif %}
                                    </div>
                                </div>
                                
                                {% if widget_data.tuik_rate is not none %}
                                <div class="yearly-widget-comparison">
                                    <div class="yearly-widget-comparison-label">TÃœÄ°K SON VERÄ°:</div>
                                    <div class="yearly-widget-comparison-value">{{ "%.2f"|format(widget_data.tuik_rate)|replace(".", ",") }}%</div>
                                </div>
                                {% endif %}
                                
                                <div style="margin-top: auto;">
                                    {% if widget_data.ytd_low is not none and widget_data.ytd_high is not none and widget_data.current_value is not none %}
                                    <div class="yearly-widget-range">
                                        <div class="yearly-widget-range-labels">
                                            <span class="yearly-widget-range-label">{{ "%.2f"|format(widget_data.ytd_low)|replace(".", ",") }}% YIL Ä°Ã‡Ä° DÃœÅÃœK</span>
                                            <span class="yearly-widget-range-label">{{ "%.2f"|format(widget_data.ytd_high)|replace(".", ",") }}% YIL Ä°Ã‡Ä° YÃœKSEK</span>
                                        </div>
                                        <div class="yearly-widget-slider">
                                            <div class="yearly-widget-slider-track">
                                                {% set range = widget_data.ytd_high - widget_data.ytd_low %}
                                                {% if range > 0 %}
                                                    {% set position = ((widget_data.current_value - widget_data.ytd_low) / range) * 100 %}
                                                {% else %}
                                                    {% set position = 50 %}
                                                {% endif %}
                                                <div class="yearly-widget-slider-thumb" style="left: {{ position }}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if widget_data.show_finalized_message %}
                                    <div class="yearly-widget-warning" style="margin-top: 12px; padding: 8px 12px; background-color: #D1FAE5; border-left: 3px solid #10B981; border-radius: 4px;">
                                        <p style="margin: 0; font-size: 11px; color: #065F46; line-height: 1.4;">
                                            <svg style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                            </svg>
                                            AylÄ±k veriler kesinleÅŸmiÅŸtir.
                                            {% if monthly_widget_data and monthly_widget_data.current_value is not none %}
                                            AylÄ±k artÄ±ÅŸ: %{{ "%.2f"|format(monthly_widget_data.current_value)|replace(".", ",") }}
                                            {% endif %}
                                            {% if widget_data.current_value is not none %}
                                            | YÄ±llÄ±k artÄ±ÅŸ: %{{ "%.2f"|format(widget_data.current_value)|replace(".", ",") }}
                                            {% endif %}
                                        </p>
                                    </div>
                                    {% else %}
                                    <div class="yearly-widget-warning" style="margin-top: 12px; padding: 8px 12px; background-color: #FEF3C7; border-left: 3px solid #F59E0B; border-radius: 4px;">
                                        <p style="margin: 0; font-size: 11px; color: #92400E; line-height: 1.4;">
                                            <svg style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                            </svg>
                                            Veriler ayÄ±n 24'Ã¼nde kesinleÅŸecektir.
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>
                                </div>
                                {% endif %}
                                
                                <!-- AylÄ±k Widget -->
                                {% if monthly_widget_data %}
                                <div class="yearly-widget-card monthly-widget-card">
                                    <div class="yearly-widget-header">
                                        <div class="yearly-widget-title-container">
                                            <div class="yearly-widget-icon">
                                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                            <div>
                                                <h2 class="yearly-widget-title">Web TÃœFE AylÄ±k Enflasyon{% if monthly_widget_data.current_month_year_label %} - {{ monthly_widget_data.current_month_year_label }}{% endif %}</h2>
                                                <p class="yearly-widget-subtitle">WebTÃœFE-AylÄ±k</p>
                                            </div>
                                        </div>
                                        {% if monthly_widget_data.update_date %}
                                        <p class="yearly-widget-update">GÃ¼ncellendi {{ monthly_widget_data.update_date }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="yearly-widget-content">
                                        <div class="yearly-widget-status">
                                            <span class="yearly-widget-status-dot"></span>
                                            {% if monthly_widget_data.show_finalized_message and monthly_widget_data.current_value is not none and monthly_widget_data.current_month_name %}
                                            <span class="yearly-widget-status-text">{{ monthly_widget_data.current_month_name }} ayÄ±nda %{{ "%.2f"|format(monthly_widget_data.current_value)|replace(".", ",") }} {% if monthly_widget_data.current_value >= 0 %}arttÄ±{% else %}azaldÄ±{% endif %}</span>
                                            {% else %}
                                            <span class="yearly-widget-status-text">AylÄ±k deÄŸiÅŸim gÃ¼nlÃ¼k gÃ¼ncelleniyor</span>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="yearly-widget-main-value">
                                            {% if monthly_widget_data.current_value is not none %}
                                            {{ "%.2f"|format(monthly_widget_data.current_value)|replace(".", ",") }}%
                                            {% else %}
                                            N/A
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: auto;">
                                        {% if monthly_widget_data.month_low is not none and monthly_widget_data.month_high is not none and monthly_widget_data.current_value is not none %}
                                        <div class="yearly-widget-range">
                                            <div class="yearly-widget-range-labels">
                                                <span class="yearly-widget-range-label">{{ "%.2f"|format(monthly_widget_data.month_low)|replace(".", ",") }}% AY Ä°Ã‡Ä° DÃœÅÃœK</span>
                                                <span class="yearly-widget-range-label">{{ "%.2f"|format(monthly_widget_data.month_high)|replace(".", ",") }}% AY Ä°Ã‡Ä° YÃœKSEK</span>
                                            </div>
                                            <div class="yearly-widget-slider">
                                                <div class="yearly-widget-slider-track">
                                                    {% set range = monthly_widget_data.month_high - monthly_widget_data.month_low %}
                                                    {% if range > 0 %}
                                                        {% set position = ((monthly_widget_data.current_value - monthly_widget_data.month_low) / range) * 100 %}
                                                    {% else %}
                                                        {% set position = 50 %}
                                                    {% endif %}
                                                    <div class="yearly-widget-slider-thumb" style="left: {{ position }}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        
                                        {% if monthly_widget_data.show_finalized_message %}
                                        <div class="yearly-widget-warning" style="margin-top: 12px; padding: 8px 12px; background-color: #D1FAE5; border-left: 3px solid #10B981; border-radius: 4px;">
                                            <p style="margin: 0; font-size: 11px; color: #065F46; line-height: 1.4;">
                                                <svg style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                            </svg>
                                                AylÄ±k veriler kesinleÅŸmiÅŸtir.
                                                {% if monthly_widget_data.current_value is not none %}
                                                AylÄ±k artÄ±ÅŸ: %{{ "%.2f"|format(monthly_widget_data.current_value)|replace(".", ",") }}
                                                {% endif %}
                                                {% if widget_data and widget_data.current_value is not none %}
                                                | YÄ±llÄ±k artÄ±ÅŸ: %{{ "%.2f"|format(widget_data.current_value)|replace(".", ",") }}
                                                {% endif %}
                                            </p>
                                        </div>
                                        {% else %}
                                        <div class="yearly-widget-warning" style="margin-top: 12px; padding: 8px 12px; background-color: #FEF3C7; border-left: 3px solid #F59E0B; border-radius: 4px;">
                                            <p style="margin: 0; font-size: 11px; color: #92400E; line-height: 1.4;">
                                                <svg style="display: inline-block; width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                            </svg>
                                                Veriler ayÄ±n 24'Ã¼nde kesinleÅŸecektir.
                                            </p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="yearly-widget-continue-btn-container">
                                <button id="yearly-widget-continue-btn" class="yearly-widget-continue-btn">
                                    <span>Siteye Devam Et</span>
                                    <svg class="yearly-widget-continue-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Ana Ä°Ã§erik -->
                    <div id="main-content-wrapper">
                    {% if widget_data or monthly_widget_data %}
                    <!-- KÃ¼Ã§Ã¼k Widget KartÄ± -->
                    <div id="compact-widget-card" class="compact-widget-card mb-6">
                        <div class="compact-widget-header">
                            <svg class="compact-widget-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                            <span>Widget'Ä± GÃ¶ster</span>
                        </div>
                        <div class="compact-widget-grid">
                            {% if widget_data %}
                            <div class="compact-widget-item">
                                <div class="compact-widget-label">YÄ±llÄ±k</div>
                                <div class="compact-widget-value">
                                    {% if widget_data.current_value is not none %}
                                    {{ "%.2f"|format(widget_data.current_value)|replace(".", ",") }}%
                                    {% else %}
                                    N/A
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if monthly_widget_data %}
                            <div class="compact-widget-item">
                                <div class="compact-widget-label">AylÄ±k</div>
                                <div class="compact-widget-value">
                                    {% if monthly_widget_data.current_value is not none %}
                                    {{ "%.2f"|format(monthly_widget_data.current_value)|replace(".", ",") }}%
                                    {% else %}
                                    N/A
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    <div class="card-modern p-8 mb-6">
                        <div class="flex items-center mb-4">
                            <div class="flex-shrink-0 mr-4">
                                <div class="p-3 rounded-full bg-gradient-to-br from-indigo-500 to-cyan-400">
                                    <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                    </svg>
                                </div>  
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-gray-900 mb-2" style="font-family: 'Poppins', sans-serif;">Web TÃœFE Åubatta %3,19 arttÄ±</h1>
                                <p class="text-gray-600 flex items-center text-base">
                                    <span class="mr-2">Åubat bÃ¼lteni yayÄ±nlandÄ±:</span>
                                    <a href="/bultenler" class="font-semibold hover:underline inline-flex items-center text-base" style="background: linear-gradient(135deg, #6366F1, #06B6D4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                        BÃ¼lten sayfasÄ±na git
                                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="-webkit-text-fill-color: currentColor;">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </a>
                                </p>
                                <p class="text-gray-600 flex items-center text-base mt-2">
                                    <span class="mr-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-800 mr-2">
                                        

                                    </span>
                                    
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Card -->
                    <div class="mb-6">
                        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl shadow-md p-6 border border-orange-100">
                            <div class="flex items-center gap-2">
                                <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide">AylÄ±k DeÄŸiÅŸim OranlarÄ± NasÄ±l HesaplanÄ±r?</h3>
                                <div class="relative group">
                                    <div class="flex items-center justify-center w-5 h-5 bg-indigo-100 rounded-full cursor-help hover:bg-indigo-200 transition-colors duration-200 animate-pulse hover:animate-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div class="absolute left-0 top-7 w-80 bg-gray-900 text-white text-xs rounded-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-xl pointer-events-none group-hover:pointer-events-auto">
                                        <p class="leading-relaxed">
                                            AylÄ±k deÄŸiÅŸim oranÄ± nihai verinin kesinleÅŸtiÄŸi 24.gÃ¼ne kadar Ã§eÅŸitli modellerle ay sonu iÃ§in verinin trendi ile tahmin edilmektedir.<br>
                                            AyÄ±n 24'Ã¼nde nihai veri 24.gÃ¼ne kadar olan ortalamanÄ±n Ã¶nceki ayÄ±n aynÄ± dÃ¶nemdeki ortalamasÄ±na gÃ¶re deÄŸiÅŸimi ile oluÅŸur.
                                        </p>
                                        <div class="absolute -top-2 left-4 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

        <div class="card-modern p-6 mb-6 relative overflow-hidden">
                        <!-- Header row: Title left, controls right -->
                        <div class="relative flex items-center justify-end mb-2">
                            <h1 class="absolute left-1/2 -translate-x-1/2 text-2xl font-bold text-gray-900">{{ chart_title }}</h1>
                            <!-- SÄ±nÄ±flandÄ±rma butonlarÄ± - sol Ã¼st kÃ¶ÅŸe -->
                            <div class="absolute left-0 top-0 flex flex-col gap-2 z-10">
                                <div class="flex gap-2">
                                    <form method="POST" action="/ana-sayfa" class="inline">
                                        <input type="hidden" name="selected_date" value="{{ selected_date or '' }}">
                                        <input type="hidden" name="period" value="{{ period or 'aylik' }}">
                                        <input type="hidden" name="classification" value="yeni">
                                        <button type="submit" class="px-3 py-1.5 text-sm font-medium rounded-lg transition-all bg-indigo-600 text-white shadow-md">
                                            Yeni SÄ±nÄ±flandÄ±rma
                                        </button>
                                    </form>
                                </div>
                                <div class="flex gap-2 items-center">
                                    <form method="POST" action="/ana-sayfa" class="inline">
                                        <input type="hidden" name="selected_date" value="{{ selected_date or '' }}">
                                        <input type="hidden" name="classification" value="{{ classification or 'yeni' }}">
                                        <input type="hidden" name="period" value="aylik">
                                        <input type="hidden" name="show_contrib" value="{% if (show_contrib is not defined) or show_contrib %}1{% else %}0{% endif %}">
                                        <button type="submit" class="px-3 py-1.5 text-sm font-medium rounded-lg transition-all {% if (period is not defined) or (period == 'aylik') %}bg-green-600 text-white shadow-md{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                                            AylÄ±k
                                        </button>
                                    </form>
                                    <form method="POST" action="/ana-sayfa" class="inline">
                                        <input type="hidden" name="selected_date" value="{{ selected_date or '' }}">
                                        <input type="hidden" name="classification" value="{{ classification or 'yeni' }}">
                                        <input type="hidden" name="period" value="yillik">
                                        <input type="hidden" name="show_contrib" value="{% if (show_contrib is not defined) or show_contrib %}1{% else %}0{% endif %}">
                                        <button type="submit" class="px-3 py-1.5 text-sm font-medium rounded-lg transition-all {% if period == 'yillik' %}bg-green-600 text-white shadow-md{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                                            YÄ±llÄ±k
                                        </button>
                                    </form>
                                    {% if False %}
                                    <!-- KatkÄ±larÄ± gÃ¶ster checkbox - AylÄ±k/YÄ±llÄ±k butonlarÄ±nÄ±n hemen saÄŸÄ±nda, aynÄ± hizada (sadece eski sÄ±nÄ±flandÄ±rma ve aylÄ±k iÃ§in) -->
                                    <form method="POST" action="/ana-sayfa" id="show-contrib-form" class="inline">
                                        <input type="hidden" name="classification" value="{{ classification or 'eski' }}">
                                        <input type="hidden" name="period" value="{{ period or 'aylik' }}">
                                        <input type="hidden" name="selected_date" value="{{ selected_date or '' }}">
                                        <label class="inline-flex items-center cursor-pointer bg-white px-3 py-1.5 rounded-lg border border-gray-300 shadow-sm hover:bg-gray-50">
                                            <input type="checkbox" name="show_contrib" value="1" {% if (show_contrib is not defined) or show_contrib %}checked{% endif %} onchange="document.getElementById('show-contrib-form').submit();" class="form-checkbox h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500">
                                            <span class="ml-2 text-sm font-medium text-gray-700">KatkÄ±larÄ± gÃ¶ster</span>
                                        </label>
                                    </form>
                                    {% endif %}
                                </div>
                            </div>
                            {% if (period is not defined) or (period == 'aylik') %}
                            <div class="bg-gray-50 rounded-lg shadow-sm p-3 border">
                                    <form id="controls-form" method="POST" action="/ana-sayfa" class="flex items-center gap-3">
                                    <input type="hidden" name="classification" value="{{ classification or 'yeni' }}">
                                    <input type="hidden" name="period" value="{{ period or 'aylik' }}">
                                    <input type="hidden" name="show_contrib" value="{% if (show_contrib is not defined) or show_contrib %}1{% else %}0{% endif %}">
                                    <label for="selected_date" class="text-sm font-medium text-gray-600 whitespace-nowrap">Tarih:</label>
                                    <select name="selected_date" id="selected_date" class="auto-submit border border-gray-300 rounded px-3 py-2 text-sm focus:ring-[#EF476F] focus:border-[#EF476F] min-w-0 bg-white">
                                        {% for date in available_dates %}
                                        <option value="{{ date }}" {% if date==selected_date %}selected{% endif %}>{{ date[:7] if date|length >= 7 else date }}</option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                        <!-- View toggle buttons removed for performance -->
                        <!-- Chart view -->
                        <div id="chart-view" class="w-full overflow-x-auto">
                            <div id="chart" class="w-full" style="min-width: 0;"></div>
                        </div>
                    </div>

        <!-- Top Movers Widgets -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Endeksler (ÃœrÃ¼nler) -->
            <div class="card-modern p-6">
                <div class="flex justify-between items-center mb-6 pb-2 border-b">
                    <h2 class="text-xl font-bold text-gray-900">Madde BazÄ±nda DeÄŸiÅŸimler</h2>
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button onclick="toggleMovers('daily', 'maddeler')" id="btn-daily-maddeler" class="px-3 py-1 rounded-md text-sm font-medium bg-white shadow-sm text-gray-900 transition-all">GÃ¼nlÃ¼k</button>
                        <button onclick="toggleMovers('monthly', 'maddeler')" id="btn-monthly-maddeler" class="px-3 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-gray-900 transition-all">AylÄ±k</button>
                        <button onclick="toggleMovers('yearly', 'maddeler')" id="btn-yearly-maddeler" class="px-3 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-gray-900 transition-all">YÄ±llÄ±k</button>
                    </div>
                </div>
                
                <!-- Daily Content -->
                <div id="content-daily-maddeler" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if top_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in top_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if top_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in top_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Monthly Content (Hidden by default) -->
                <div id="content-monthly-maddeler" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if monthly_top_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in monthly_top_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if monthly_top_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in monthly_top_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Yearly Content (Hidden by default) -->
                <div id="content-yearly-maddeler" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if yearly_top_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in yearly_top_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if yearly_top_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in yearly_top_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Harcama GruplarÄ± -->
            <div class="card-modern p-6">
                <div class="flex justify-between items-center mb-6 pb-2 border-b">
                    <h2 class="text-xl font-bold text-gray-900">Harcama Grubu BazÄ±nda DeÄŸiÅŸimler</h2>
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button onclick="toggleMovers('daily', 'harcama')" id="btn-daily-harcama" class="px-3 py-1 rounded-md text-sm font-medium bg-white shadow-sm text-gray-900 transition-all">GÃ¼nlÃ¼k</button>
                        <button onclick="toggleMovers('monthly', 'harcama')" id="btn-monthly-harcama" class="px-3 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-gray-900 transition-all">AylÄ±k</button>
                        <button onclick="toggleMovers('yearly', 'harcama')" id="btn-yearly-harcama" class="px-3 py-1 rounded-md text-sm font-medium text-gray-500 hover:text-gray-900 transition-all">YÄ±llÄ±k</button>
                    </div>
                </div>
                
                <!-- Daily Content -->
                <div id="content-daily-harcama" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if top_harcama_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in top_harcama_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if top_harcama_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in top_harcama_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Monthly Content (Hidden by default) -->
                <div id="content-monthly-harcama" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if monthly_top_harcama_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in monthly_top_harcama_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if monthly_top_harcama_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in monthly_top_harcama_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Yearly Content (Hidden by default) -->
                <div id="content-yearly-harcama" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <!-- Artanlar -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                            En Ã‡ok Artanlar
                        </h3>
                        {% if yearly_top_harcama_risers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in yearly_top_harcama_risers %}
                            <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg border border-red-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-red-600 whitespace-nowrap">+{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>

                    <!-- DÃ¼ÅŸenler -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            En Ã‡ok DÃ¼ÅŸenler
                        </h3>
                        {% if yearly_top_harcama_fallers %}
                        <div class="space-y-2 max-h-64 overflow-y-auto pr-2">
                            {% for name, value in yearly_top_harcama_fallers %}
                            <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-100">
                                <span class="text-sm font-medium text-gray-700 truncate mr-2" title="{{ name }}">{{ name }}</span>
                                <span class="text-sm font-bold text-green-600 whitespace-nowrap">{{ "%.2f"|format(value) }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-sm text-gray-500 italic">Veri bulunamadÄ±</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
                    </div>

    </main>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // YÄ±llÄ±k Widget Banner KontrolÃ¼
        (function() {
            const banner = document.getElementById('yearly-widget-banner');
            const continueBtn = document.getElementById('yearly-widget-continue-btn');
            const compactWidgetCard = document.getElementById('compact-widget-card');
            const mainContent = document.getElementById('main-content-wrapper');
            
            if (banner && continueBtn && mainContent) {
                const bannerDismissed = sessionStorage.getItem('yearly-widget-dismissed');
                
                if (bannerDismissed === 'true') {
                    // Daha Ã¶nce kapatÄ±lmÄ±ÅŸsa banner'Ä± gizle, kÃ¼Ã§Ã¼k widget'Ä± gÃ¶ster
                    banner.classList.remove('show');
                    mainContent.classList.remove('main-content-hidden');
                    if (compactWidgetCard) {
                        compactWidgetCard.style.display = 'flex';
                    }
                } else {
                    // Ä°lk aÃ§Ä±lÄ±ÅŸta banner'Ä± gÃ¶ster
                    banner.classList.add('show');
                    mainContent.classList.add('main-content-hidden');
                    if (compactWidgetCard) {
                        compactWidgetCard.style.display = 'none';
                    }
                }
                
                // KÃ¼Ã§Ã¼k widget kartÄ±na tÄ±klayÄ±nca banner'Ä± aÃ§
                if (compactWidgetCard) {
                    compactWidgetCard.addEventListener('click', function() {
                        banner.style.opacity = '1';
                        banner.style.transition = 'opacity 0.3s ease-out';
                        banner.classList.add('show');
                        mainContent.classList.add('main-content-hidden');
                        compactWidgetCard.style.display = 'none';
                        sessionStorage.removeItem('yearly-widget-dismissed');
                        
                        // Grafikleri yeniden boyutlandÄ±r (widget aÃ§Ä±ldÄ±ÄŸÄ±nda)
                        setTimeout(function() {
                            const chartElement = document.getElementById('chart');
                            if (chartElement) {
                                Plotly.Plots.resize('chart');
                            }
                        }, 100);
                    });
                }
                
                continueBtn.addEventListener('click', function() {
                    // Banner'Ä± gizle
                    banner.style.opacity = '0';
                    banner.style.transition = 'opacity 0.3s ease-out';
                    
                    setTimeout(function() {
                        banner.classList.remove('show');
                        mainContent.classList.remove('main-content-hidden');
                        if (compactWidgetCard) {
                            compactWidgetCard.style.display = 'flex';
                        }
                        // SayfayÄ± yumuÅŸak bir ÅŸekilde en Ã¼ste kaydÄ±r
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        sessionStorage.setItem('yearly-widget-dismissed', 'true');
                        
                        // Grafikleri yeniden boyutlandÄ±r
                        setTimeout(function() {
                            const chartElement = document.getElementById('chart');
                            if (chartElement) {
                                Plotly.Plots.resize('chart');
                            }
                        }, 100);
                    }, 300);
                });
            }
        })();
    </script>
    <script id="graphs-data" type="application/json">{{ graphJSON | safe }}</script>
    <script>
        var graphs = JSON.parse(document.getElementById('graphs-data').textContent);
        // Update layout to ensure chart fits within container
        if (graphs.layout) {
            graphs.layout.autosize = true;
            graphs.layout.width = null; // Let Plotly calculate width
            graphs.layout.height = graphs.layout.height || 640;
            if (graphs.layout.margin) {
                graphs.layout.margin.l = Math.min(graphs.layout.margin.l || 40, 40);
                graphs.layout.margin.r = Math.min(graphs.layout.margin.r || 40, 40);
            }
        }
        Plotly.newPlot('chart', graphs.data, graphs.layout, { 
            displayModeBar: false, 
            responsive: true,
            autosize: true
        });
        window.addEventListener('resize', function () {
            Plotly.Plots.resize('chart');
        });
        (function () {
            var form = document.getElementById('controls-form');
            if (form) {
                function saveScroll() {
                    try {
                        var y = window.pageYOffset || document.documentElement.scrollTop || 0;
                        sessionStorage.setItem('index_scroll_y', String(y));
                    } catch (e) {}
                }
                // Submit on change, after saving scroll
                var autos = form.querySelectorAll('.auto-submit');
                autos.forEach(function (el) {
                    el.addEventListener('change', function () {
                        saveScroll();
                        form.submit();
                    });
                });
                // Fallback: if something else triggers submit
                form.addEventListener('submit', saveScroll);
            }
            // Prevent browser auto-restoring to top
            try { if ('scrollRestoration' in history) { history.scrollRestoration = 'manual'; } } catch(e) {}
            function restore() {
                try {
                    var saved = sessionStorage.getItem('index_scroll_y');
                    if (saved !== null) {
                        var y = parseInt(saved, 10);
                        window.scrollTo(0, y);
                    }
                } catch (e) {}
            }
            window.addEventListener('load', function () {
                restore();
                // Re-apply after layout settles
                setTimeout(restore, 150);
                setTimeout(restore, 400);
            });
        })();

    function toggleMovers(type, category) {
        const dailyBtn = document.getElementById(`btn-daily-${category}`);
        const monthlyBtn = document.getElementById(`btn-monthly-${category}`);
        const yearlyBtn = document.getElementById(`btn-yearly-${category}`);
        const dailyContent = document.getElementById(`content-daily-${category}`);
        const monthlyContent = document.getElementById(`content-monthly-${category}`);
        const yearlyContent = document.getElementById(`content-yearly-${category}`);

        // Reset all buttons
        [dailyBtn, monthlyBtn, yearlyBtn].forEach(btn => {
            if (btn) {
                btn.classList.remove('bg-white', 'shadow-sm', 'text-gray-900');
                btn.classList.add('text-gray-500', 'hover:text-gray-900');
            }
        });

        // Hide all content
        [dailyContent, monthlyContent, yearlyContent].forEach(content => {
            if (content) {
                content.classList.add('hidden');
            }
        });

        // Show selected type
        if (type === 'daily') {
            if (dailyBtn) {
                dailyBtn.classList.remove('text-gray-500', 'hover:text-gray-900');
                dailyBtn.classList.add('bg-white', 'shadow-sm', 'text-gray-900');
            }
            if (dailyContent) {
                dailyContent.classList.remove('hidden');
            }
        } else if (type === 'monthly') {
            if (monthlyBtn) {
                monthlyBtn.classList.remove('text-gray-500', 'hover:text-gray-900');
                monthlyBtn.classList.add('bg-white', 'shadow-sm', 'text-gray-900');
            }
            if (monthlyContent) {
                monthlyContent.classList.remove('hidden');
            }
        } else if (type === 'yearly') {
            if (yearlyBtn) {
                yearlyBtn.classList.remove('text-gray-500', 'hover:text-gray-900');
                yearlyBtn.classList.add('bg-white', 'shadow-sm', 'text-gray-900');
            }
            if (yearlyContent) {
                yearlyContent.classList.remove('hidden');
            }
        }
    }

    // toggleView function removed for performance optimization
</script>
{% endblock %}