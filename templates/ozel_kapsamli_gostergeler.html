<!DOCTYPE html>
<html lang="tr">

<head>
    <script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="a08a9892-f499-44e5-8677-79d5507c65c8"
        type="text/javascript" async></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7F6ESCSLNT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7F6ESCSLNT');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5889238450559775"
        crossorigin="anonymous"></script>

    <title>Özel Kapsamlı Göstergeler - Web TÜFE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366F1;
            --secondary-color: #06B6D4;
            --accent-color: #F97316;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-modern {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        .card-modern:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-5px);
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
        }

        .nav-link-modern {
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link-modern::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }

        .nav-link-modern:hover::after {
            width: 100%;
        }

        .graph-container {
            margin-top: 2rem;
        }

        .graph-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: linear-gradient(135deg, #f5f7fa, #e9ecef);
            color: #2B2D42;
            cursor: pointer;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #EF476F, #dc3558);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 71, 111, 0.4);
        }

        .tab-button svg {
            width: 18px;
            height: 18px;
        }

        .graph-content {
            display: none;
            overflow-x: auto;
        }

        .graph-content.active {
            display: block;
            overflow-x: auto;
        }

        .graph-content {
            width: 100% !important;
            /* Ensure full width */
        }

        #bar-chart,
        #line-chart {
            width: 100% !important;
            /* Ensure full width */
        }
    </style>
</head>

<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header>
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5">
                <div class="flex items-center space-x-3">
                    <a href="/" class="text-2xl font-bold gradient-text nav-link-modern" style="font-family: 'Poppins', sans-serif;">Web TÜFE</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/tufe"
                        class="nav-link-modern font-semibold {% if active_page == 'tufe' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">TÜFE</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/ana-gruplar"
                        class="nav-link-modern font-semibold {% if active_page == 'ana_gruplar' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Ana
                        Gruplar</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/harcama-gruplari"
                        class="nav-link-modern font-semibold {% if active_page == 'harcama_gruplari' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Harcama
                        Grupları</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/maddeler"
                        class="nav-link-modern font-semibold {% if active_page == 'maddeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Maddeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/ozel-kapsamli-gostergeler"
                        class="nav-link-modern font-semibold {% if active_page == 'ozel_kapsamli_gostergeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Özel
                        Kapsamlı Göstergeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/mevsimsel-duzeltilmis-gostergeler"
                        class="nav-link-modern font-semibold {% if active_page == 'mevsimsel_duzeltilmis_gostergeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Mevsimsel
                        Düzeltilmiş Göstergeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/bultenler" class="nav-link-modern font-semibold text-gray-600 hover:text-indigo-600">Bültenler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/metodoloji" class="nav-link-modern font-semibold text-gray-600 hover:text-indigo-600">Metodoloji</a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Form -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <form method="POST" class="flex items-center space-x-4">
                    <select name="indicator"
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-[#EF476F] focus:ring focus:ring-[#EF476F] focus:ring-opacity-50"
                        onchange="this.form.submit()">
                        {% for indicator in indicator_names %}
                        <option value="{{ indicator }}" {% if indicator==selected_indicator %}selected{% endif %}>{{
                            indicator }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl shadow-md p-6 border border-blue-100">
                    <h3 class="text-sm font-semibold text-gray-600 mb-2 uppercase tracking-wide">Yılbaşından İtibaren Değişim</h3>
                    <p class="text-4xl font-bold mb-1 {% if total_change > 0 %}text-red-600{% elif total_change < 0 %}text-green-600{% else %}text-gray-700{% endif %}">
                        {% if total_change is not none %}
                        {{ "%.2f"|format(total_change) }}%
                        {% else %}
                        -
                        {% endif %}
                    </p>
                    <p class="text-xs text-gray-500">1.01.2025 - {{ last_date.strftime('%d.%m.%Y') }}</p>
                </div>
                <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl shadow-md p-6 border border-orange-100">
                    <div class="flex items-center gap-2 mb-2">
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide">{{ month_name }} Aylık Değişim</h3>
                        <div class="relative group">
                            <div class="flex items-center justify-center w-5 h-5 bg-indigo-100 rounded-full cursor-help hover:bg-indigo-200 transition-colors duration-200 animate-pulse hover:animate-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="absolute left-0 top-7 w-64 bg-gray-900 text-white text-xs rounded-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-xl">
                                <p class="leading-relaxed">Aylık değişim oranı ilk 24 güne kadar aylık ortalamanın aynı dönemdeki önceki ay ortalamasına göre değişimi ile hesaplanır. Ayın 24'ünden önce ise nihai veri oluşana kadar mevcut güne kadar olan ortalamaları karşılaştırır.</p>
                                <div class="absolute -top-2 left-4 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-gray-900"></div>
                            </div>
                        </div>
                    </div>
                    <p class="text-4xl font-bold mb-1 {% if monthly_change > 0 %}text-red-600{% elif monthly_change < 0 %}text-green-600{% else %}text-gray-700{% endif %}">
                        {% if monthly_change is not none %}
                        {{ "%.2f"|format(monthly_change) }}%
                        {% else %}
                        -
                        {% endif %}
                    </p>
                    <p class="text-xs text-gray-500">Bir önceki aya göre</p>
                </div>
            </div>

            <!-- Index Chart -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <div id="index-chart" class="w-full" style="height: 500px;"></div>
            </div>

            <!-- Monthly Change Charts -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="graph-tabs">
                    <button class="tab-button active" onclick="showGraph('bar')">Bar Grafik</button>
                    <button class="tab-button" onclick="showGraph('line')">Line Grafik</button>
                </div>
                <div id="bar-chart" class="graph-content active" style="height: 400px;"></div>
                <div id="line-chart" class="graph-content" style="height: 400px;"></div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t mt-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <p class="text-center text-gray-500 text-sm">
                    © 2024 Web TÜFE. Tüm hakları saklıdır.
                </p>
            </div>
        </footer>
    </div>

    <script>
        console.log('Script started');  // Test log

        // Check if Plotly is loaded
        if (typeof Plotly === 'undefined') {
            console.error('Plotly library is not loaded!');
        } else {
            console.log('Plotly library is loaded successfully');
        }

        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM Content Loaded');  // Test log
            try {
                // Index Chart
                const rawGraphJSON = '{{ graphJSON | tojson | safe }}';
                console.log('Raw graphJSON:', rawGraphJSON);
                let indexGraphData;
                try {
                    // Remove extra quotes if present
                    const cleanJSON = rawGraphJSON.replace(/^"|"$/g, '');
                    indexGraphData = JSON.parse(cleanJSON);
                    console.log('Parsed Index Graph Data:', indexGraphData);
                    if (indexGraphData && indexGraphData.data && indexGraphData.layout) {
                        Plotly.newPlot('index-chart', indexGraphData.data, indexGraphData.layout, {
                            displayModeBar: false,
                            responsive: true,
                            scrollZoom: true
                        });
                    } else {
                        console.error('Invalid index graph data structure:', indexGraphData);
                    }
                } catch (parseError) {
                    console.error('Error parsing index graph JSON:', parseError);
                }

                // Bar Chart
                const rawBarGraphJSON = '{{ bar_graphJSON | tojson | safe }}';
                console.log('Raw bar_graphJSON:', rawBarGraphJSON);
                let barGraphData;
                try {
                    // Remove extra quotes if present
                    const cleanJSON = rawBarGraphJSON.replace(/^"|"$/g, '');
                    barGraphData = JSON.parse(cleanJSON);
                    console.log('Parsed Bar Graph Data:', barGraphData);
                    if (barGraphData && barGraphData.data && barGraphData.layout) {
                        Plotly.newPlot('bar-chart', barGraphData.data, barGraphData.layout, {
                            displayModeBar: false,
                            responsive: true
                        });
                    } else {
                        console.error('Invalid bar graph data structure:', barGraphData);
                    }
                } catch (parseError) {
                    console.error('Error parsing bar graph JSON:', parseError);
                }

                // Line Chart
                const rawLineGraphJSON = '{{ line_graphJSON | tojson | safe }}';
                console.log('Raw line_graphJSON:', rawLineGraphJSON);
                let lineGraphData;
                try {
                    // Remove extra quotes if present
                    const cleanJSON = rawLineGraphJSON.replace(/^"|"$/g, '');
                    lineGraphData = JSON.parse(cleanJSON);
                    console.log('Parsed Line Graph Data:', lineGraphData);
                    if (lineGraphData && lineGraphData.data && lineGraphData.layout) {
                        Plotly.newPlot('line-chart', lineGraphData.data, lineGraphData.layout, {
                            displayModeBar: false,
                            responsive: true
                        });
                    } else {
                        console.error('Invalid line graph data structure:', lineGraphData);
                    }
                } catch (parseError) {
                    console.error('Error parsing line graph JSON:', parseError);
                }

                // Handle window resize
                window.addEventListener('resize', function () {
                    Plotly.Plots.resize('index-chart');

                    // Only resize visible chart
                    const activeChart = document.querySelector('.graph-content.active');
                    if (activeChart) {
                        const chartId = activeChart.id;
                        Plotly.Plots.resize(chartId);
                    }
                });
            } catch (error) {
                console.error('Error initializing graphs:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack
                });
            }
        });

        function showGraph(type) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.graph-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="showGraph('${type}')"]`).classList.add('active');
            document.getElementById(`${type}-chart`).classList.add('active');

            // Resize the chart after showing it
            setTimeout(function () {
                Plotly.Plots.resize(`${type}-chart`);
            }, 100);
        }
    </script>
</body>

</html>