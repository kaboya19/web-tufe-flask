<!DOCTYPE html>
<html lang="tr">

<head>
    <script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="a08a9892-f499-44e5-8677-79d5507c65c8"
        type="text/javascript" async></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7F6ESCSLNT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7F6ESCSLNT');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5889238450559775"
        crossorigin="anonymous"></script>

    <title>Harcama Grupları - Web TÜFE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366F1;
            --secondary-color: #06B6D4;
            --accent-color: #F97316;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-modern {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        .card-modern:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-5px);
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
        }

        .nav-link-modern {
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link-modern::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }

        .nav-link-modern:hover::after {
            width: 100%;
        }

        .graph-container {
            margin-top: 2rem;
        }

        .graph-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: linear-gradient(135deg, #f5f7fa, #e9ecef);
            color: #2B2D42;
            cursor: pointer;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #EF476F, #dc3558);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 71, 111, 0.4);
        }

        .tab-button svg {
            width: 18px;
            height: 18px;
        }

        .graph-content {
            display: none;
            overflow-x: auto;
        }

        .graph-content.active {
            display: block;
            overflow-x: auto;
        }

        .graph-content {
            width: 100% !important;
            /* Ensure full width */
        }
    </style>
</head>

<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header>
            <div class="w-full px-6 lg:px-8 py-5">
                <div class="flex items-center space-x-3">
                    <a href="/" class="text-2xl font-bold gradient-text nav-link-modern" style="font-family: 'Poppins', sans-serif;">Web TÜFE</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/tufe"
                        class="nav-link-modern font-semibold {% if active_page == 'tufe' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">TÜFE</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/ana-gruplar"
                        class="nav-link-modern font-semibold {% if active_page == 'ana_gruplar' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Ana
                        Gruplar</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/harcama-gruplari"
                        class="nav-link-modern font-semibold {% if active_page == 'harcama_gruplari' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Harcama
                        Grupları</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/maddeler"
                        class="nav-link-modern font-semibold {% if active_page == 'maddeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Maddeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/ozel-kapsamli-gostergeler"
                        class="nav-link-modern font-semibold {% if active_page == 'ozel_kapsamli_gostergeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Özel
                        Kapsamlı Göstergeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/mevsimsel-duzeltilmis-gostergeler"
                        class="nav-link-modern font-semibold {% if active_page == 'mevsimsel_duzeltilmis_gostergeler' %}text-indigo-600{% else %}text-gray-600 hover:text-indigo-600{% endif %}">Mevsimsel
                        Düzeltilmiş Göstergeler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/bultenler" class="nav-link-modern font-semibold text-gray-600 hover:text-indigo-600">Bültenler</a>
                    <span class="text-gray-300 font-light">|</span>
                    <a href="/metodoloji" class="nav-link-modern font-semibold text-gray-600 hover:text-indigo-600">Metodoloji</a>
                </div>
            </div>
        </header>
        <!-- Main Content -->
        <main class="w-full px-6 lg:px-8 py-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <form method="POST" class="mb-6 flex items-center space-x-4">
                    <label for="group" class="font-bold text-black text-lg">Ana Grup Seçin:</label>
                    <select name="group" id="group" class="border border-gray-300 rounded px-3 py-2 text-lg"
                        onchange="this.form.submit()">
                        {% for grup in grup_adlari %}
                        <option value="{{ grup }}" {% if grup==selected_group %}selected{% endif %}>{{ grup }}</option>
                        {% endfor %}
                    </select>
                    <label for="date" class="font-bold text-black text-lg ml-4">Tarih Seçin:</label>
                    <select name="date" id="date" class="border border-gray-300 rounded px-3 py-2 text-lg"
                        onchange="this.form.submit()">
                        {% for date in date_options %}
                        <option value="{{ date }}" {% if date==selected_date %}selected{% endif %}>{{ date }}</option>
                        {% endfor %}
                    </select>
                    <label class="ml-6 flex items-center gap-2">
                        <input type="checkbox" name="show_contrib" {% if show_contrib %}checked{% endif %} onchange="this.form.submit()">
                        <span>Katkıları göster</span>
                    </label>
                    <div class="ml-4 flex items-center gap-4">
                        <label class="flex items-center gap-2">
                            <input type="radio" name="contrib_type" value="ana" {% if contrib_type=='ana' %}checked{% endif %} onchange="this.form.submit()">
                            <span>Ana gruba katkı</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="radio" name="contrib_type" value="manset" {% if contrib_type=='manset' %}checked{% endif %} onchange="this.form.submit()">
                            <span>Manşet enflasyona katkı</span>
                        </label>
                    </div>
                </form>

                {% if harcama_grubu_adlari %}
                <form method="POST" class="mb-6 flex items-center space-x-4">
                    <input type="hidden" name="group" value="{{ selected_group }}">
                    <input type="hidden" name="date" value="{{ selected_date }}">
                    <label for="harcama_grubu" class="font-bold text-black text-lg">Harcama Grubu Seçin:</label>
                    <select name="harcama_grubu" id="harcama_grubu"
                        class="border border-gray-300 rounded px-3 py-2 text-lg" onchange="this.form.submit()">
                        <option value="" {% if not selected_harcama_grubu %}selected{% endif %}>Seçiniz</option>
                        {% for hgrup in harcama_grubu_adlari %}
                        <option value="{{ hgrup }}" {% if hgrup==selected_harcama_grubu %}selected{% endif %}>{{
                            hgrup.title() }}</option>
                        {% endfor %}
                    </select>
                </form>
                {% endif %}

                {% if selected_group and selected_date and not selected_harcama_grubu %}
                <div class="mt-8">
                    {% if combined_graphJSON and show_contrib %}
                    <div id="contrib-combined-chart" class="w-full" style="min-height: 640px;"></div>
                    {% else %}
                    <div id="bar-chart" class="w-full" style="min-height: 640px;"></div>
                    {% endif %}
                </div>
                {% endif %}

                {% if harcama_grubu_endeks_graphJSON %}
                <div class="mt-8">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl shadow-md p-6 border border-blue-100">
                            <h3 class="text-sm font-semibold text-gray-600 mb-2 uppercase tracking-wide">Yılbaşından İtibaren Değişim</h3>
                            <p class="text-4xl font-bold mb-1 {% if harcama_grubu_total_change > 0 %}text-red-600{% elif harcama_grubu_total_change < 0 %}text-green-600{% else %}text-gray-700{% endif %}">
                                {{ '%.2f' % harcama_grubu_total_change }}%
                            </p>
                            <p class="text-xs text-gray-500">{{ toplam_baslik }}</p>
                        </div>
                        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl shadow-md p-6 border border-orange-100">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide">{{ son_ay }} Aylık Değişim</h3>
                                <div class="relative group">
                                    <div class="flex items-center justify-center w-5 h-5 bg-indigo-100 rounded-full cursor-help hover:bg-indigo-200 transition-colors duration-200 animate-pulse hover:animate-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div class="absolute left-0 top-7 w-64 bg-gray-900 text-white text-xs rounded-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-xl">
                                        <p class="leading-relaxed">Aylık değişim oranı ilk 24 güne kadar aylık ortalamanın aynı dönemdeki önceki ay ortalamasına göre değişimi ile hesaplanır. Ayın 24'ünden önce ise nihai veri oluşana kadar mevcut güne kadar olan ortalamaları karşılaştırır.</p>
                                        <div class="absolute -top-2 left-4 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-gray-900"></div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-4xl font-bold mb-1 {% if harcama_grubu_monthly_change > 0 %}text-red-600{% elif harcama_grubu_monthly_change < 0 %}text-green-600{% else %}text-gray-700{% endif %}">
                                {{ '%.2f' % harcama_grubu_monthly_change }}%
                            </p>
                            <p class="text-xs text-gray-500">Bir önceki aya göre</p>
                        </div>
                    </div>
                    <div id="harcama-endeks-chart" class="w-full" style="min-height: 500px;"></div>
                </div>

                <!-- Monthly Change Charts -->
                <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
                    <div class="graph-tabs">
                        <button class="tab-button active" onclick="showGraph('bar')">Bar Grafik</button>
                        <button class="tab-button" onclick="showGraph('line')">Line Grafik</button>
                    </div>
                    <div id="monthly-bar-chart" class="graph-content active" style="height: 400px;"></div>
                    <div id="monthly-line-chart" class="graph-content" style="height: 400px;"></div>
                </div>
                {% endif %}
                {% if contrib_graphJSON %}
                <div class="mt-8">
                    <div id="contrib-chart" class="w-full" style="min-height: 600px;"></div>
                </div>
                {% endif %}
            </div>
        </main>
        <!-- Footer -->
        <footer class="bg-white border-t mt-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <p class="text-center text-gray-500 text-sm">
                    © 2024 Web TÜFE. Tüm hakları saklıdır.
                </p>
            </div>
        </footer>
    </div>
    {% if selected_group and selected_date and bar_graphJSON and not selected_harcama_grubu and not show_contrib %}
    <script>
        var barGraphs = {{ bar_graphJSON | safe }};
        Plotly.newPlot('bar-chart', barGraphs.data, barGraphs.layout, {
            displayModeBar: false,
            responsive: true
        });
    </script>
    {% endif %}
    {% if contrib_graphJSON %}
    <script>
        var contribGraph = {{ contrib_graphJSON | safe }};
        Plotly.newPlot('contrib-chart', contribGraph.data, contribGraph.layout, {
            displayModeBar: false,
            responsive: true
        });
    </script>
    {% endif %}
    {% if combined_graphJSON and show_contrib %}
    <script>
        var combinedGraph = {{ combined_graphJSON | safe }};
        Plotly.newPlot('contrib-combined-chart', combinedGraph.data, combinedGraph.layout, {
            displayModeBar: false,
            responsive: true
        });
    </script>
    {% endif %}
    {% if harcama_grubu_endeks_graphJSON %}
    <script>
        var endeksGraph = {{ harcama_grubu_endeks_graphJSON | safe }};
        Plotly.newPlot('harcama-endeks-chart', endeksGraph.data, endeksGraph.layout, {
            displayModeBar: false,
            responsive: true
        });

        {% if monthly_bar_graphJSON and monthly_line_graphJSON %}
        var monthlyBarGraph = {{ monthly_bar_graphJSON | safe }};
        var monthlyLineGraph = {{ monthly_line_graphJSON | safe }};
        Plotly.newPlot('monthly-bar-chart', monthlyBarGraph.data, monthlyBarGraph.layout, { displayModeBar: false, responsive: true });
        Plotly.newPlot('monthly-line-chart', monthlyLineGraph.data, monthlyLineGraph.layout, { displayModeBar: false, responsive: true });
        {% endif %}
    </script>
    {% endif %}
    <script>
        function showGraph(type) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.graph-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="showGraph('${type}')"]`).classList.add('active');
            document.getElementById(`monthly-${type}-chart`).classList.add('active');
            setTimeout(function () {
                Plotly.Plots.resize(`monthly-${type}-chart`);
            }, 100);
        }
    </script>
</body>

</html>